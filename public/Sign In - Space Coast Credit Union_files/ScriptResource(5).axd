(function(n){n.widget("ui.selectmenu",n.ui.selectmenu,{options:{position:{collision:"flip"}},_drawButton:function(){var t,i=this,u=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex),r;this.labels=this.element.labels().attr("id",this.ids.button+"_label").removeAttr("for");this._on(this.labels,{click:function(n){this.button.focus();n.preventDefault()}});this.element.hide();this.button=n("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element);this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget");t=n("<span>").appendTo(this.button);this._addClass(t,"ui-selectmenu-icon","ui-icon "+this.options.icons.button);this.buttonItem=this._renderButtonItem(u).appendTo(this.button);this.options.width!==!1&&this._resizeButton();this._on(this.button,this._buttonEvents);this.button.one("focusin",function(){i._rendered||i._refreshMenu()});this.element.length>0&&this.element[0].CalloutId!=null&&(r=document.getElementById(this.element[0].CalloutId),Callout_init(this.element[0].CalloutId,this.ids.button,r.Position))},_drawMenu:function(){var t=this;this.menu=n("<ul>",{"aria-hidden":"true",id:this.ids.menu});this.menuWrap=n("<div>").append(this.menu);this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front");this.menuWrap.appendTo(this._appendTo());this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(n,i){n.preventDefault();t._setSelection();t._select(i.item.data("ui-selectmenu-item"),n)},focus:function(n,i){var r=i.item.data("ui-selectmenu-item");t.focusIndex!=null&&r.index!==t.focusIndex&&(t._trigger("focus",n,{item:r}),t.isOpen||t._select(r,n));t.focusIndex=r.index;t.button.attr("aria-activedescendant",t.menuItems.eq(r.index).attr("id"))}}).menu("instance");this.menuInstance._off(this.menu,"mouseleave");n("#"+this.menuInstance.element[0].id).on("mouseleave",function(){t._removeClass(t.menu.find(".ui-state-active"),null,"ui-state-active")});this.menuInstance._closeOnDocumentClick=function(){return!1};this.menuInstance._isDivider=function(){return!1}},_renderItem:function(t,i){var u=n("<li>"),r=n("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(u,null,"ui-state-disabled"),r.attr("aria-selected",this.element[0].selectedIndex===i.index),this._setText(r,i.label),u.append(r).appendTo(t)},_select:function(n,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=n.index;this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(n));this._setAria(n);this.menuItems.eq(i).attr("aria-selected",!1);this.menuItems.eq(n.index).attr("aria-selected",!0);this._trigger("select",t,{item:n});n.index!==i&&(this._trigger("change",t,{item:n}),this.element[0].dispatchEvent(new Event("change")));this.close(t)},_setAria:function(n){var t=this.menuItems.eq(n.index).attr("id");this.button.attr({"aria-labelledby":this.ids.button+"_label","aria-activedescendant":t});this.menu.attr("aria-activedescendant",t)},_resizeMenu:function(){this.menu.outerWidth(this.button.outerWidth())}})})(jQuery);